/*! curtain - v2.0.1 - 2013-08-10
* Copyright (c) 2013 ; Licensed  */
!function(a,b,c,d){function e(b,c){this.element=b,this.options=a.extend({},g,c),this._defaults=g,this._name=f,this._ignoreHashChange=!1,this.init()}var f="curtain",g={scrollSpeed:400,bodyHeight:0,linksArray:[],mobile:!1,scrollButtons:{},controls:null,curtainLinks:".curtain-links",enableKeys:!0,easing:"swing",disabled:!1,nextSlide:function(){},prevSlide:function(){},beforeLink:function(){}};e.prototype={init:function(){var d=this;this.$element=a(this.element),this.$li=a(this.element).find(">li"),this.$liLength=this.$li.length,d.$windowHeight=a(b).height(),d.$elDatas={},d.$document=a(c),d.$window=a(b),d.webkit=navigator.userAgent.indexOf("Chrome")>-1||navigator.userAgent.indexOf("Safari")>-1,a.Android=navigator.userAgent.match(/Android/i),a.iPhone=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i),a.iPad=navigator.userAgent.match(/iPad/i),a.iOs4=/OS [1-4]_[0-9_]+ like Mac OS X/i.test(navigator.userAgent),(a.iPhone||a.iPad||a.Android||d.options.disabled)&&(this.options.mobile=!0,this.$li.css({position:"relative"}),this.$element.find(".fixed").css({position:"absolute"}));var e=!1;(navigator.userAgent.match(/mozilla/i)||navigator.userAgent.match(/msie/i))&&(e=!0),this.scrollEl=this.options.mobile?this.$element:e?a("html"):a("body"),d.options.controls&&(d.options.scrollButtons.up=a(d.options.controls).find('[href="#up"]'),d.options.scrollButtons.down=a(d.options.controls).find('[href="#down"]'),a.iOs4||!a.iPhone&&!a.iPad||(d.$element.css({position:"fixed",top:0,left:0,right:0,bottom:0,"-webkit-overflow-scrolling":"touch",overflow:"auto"}),a(d.options.controls).css({position:"absolute"})));var f=function(){d.setDimensions(),d.$li.eq(0).addClass("current"),d.setCache(),d.options.mobile||d.$li.eq(1).length&&d.$li.eq(1).nextAll().addClass("hidden"),d.setEvents(),d.setLinks(),d.isHashIsOnList(location.hash.substring(1))};d.$element.find("img").length?d.$element.imagesLoaded().always(f):f()},scrollToPosition:function(b){var c=null,e=this;if(e.scrollEl.is(":animated"))return!1;if("up"===b||"down"===b){var f="up"===b?e.$current.prev():e.$current.next();if(e.$step){e.$current.find(".current-step").length||e.$step.eq(0).addClass("current-step");var g="up"===b?e.$current.find(".current-step").prev(".step"):e.$current.find(".current-step").next(".step");g.length&&(c=e.options.mobile?g.position().top+e.$elDatas[e.$current.index()]["data-position"]:g.position().top+e.$elDatas[e.$current.index()]["data-position"])}c=c||(e.$elDatas[f.index()]===d?null:e.$elDatas[f.index()]["data-position"]),null!==c&&e.scrollEl.animate({scrollTop:c},e.options.scrollSpeed,e.options.easing)}else if("top"===b)e.scrollEl.animate({scrollTop:0},e.options.scrollSpeed,e.options.easing);else if("bottom"===b)e.scrollEl.animate({scrollTop:e.options.bodyHeight},e.options.scrollSpeed,e.options.easing);else{var h=a("#"+b).index(),i=Math.abs(e.currentIndex-h)*4*this.options.scrollSpeed/e.$liLength;e.scrollEl.animate({scrollTop:e.$elDatas[h]["data-position"]||null},i<=e.options.scrollSpeed?e.options.scrollSpeed:i,this.options.easing)}},scrollEvent:function(){var b=this,c=b.$document.scrollTop();c<b.currentP&&b.currentIndex>0?(b._ignoreHashChange=!0,b.$current.prev().attr("id")&&b.setHash(b.$current.prev().attr("id")),b.$current.removeClass("current").css(b.webkit?{"-webkit-transform":"translateY(0px) translateZ(0)"}:{marginTop:0}).nextAll().addClass("hidden").end().prev().addClass("current").removeClass("hidden"),b.setCache(),b.options.prevSlide()):c<b.currentP+b.currentHeight?(b.webkit?b.$current.css({"-webkit-transform":"translateY("+-(c-b.currentP)+"px) translateZ(0)"}):b.$current.css({marginTop:-(c-b.currentP)}),b.$fixedLength&&(parseInt(b.$fixed.attr("data-top"),10),c+b.$windowHeight>=b.currentP+b.currentHeight?b.$fixed.css({position:"fixed"}):b.$fixed.css({position:"absolute",marginTop:Math.abs(c-b.currentP)})),b.$stepLength&&a.each(b.$step,function(d,e){return a(e).position().top+b.currentP<=c+5&&a(e).position().top+b.currentP+a(e).height()>=c+5&&!a(e).hasClass("current-step")?(b.$step.removeClass("current-step"),a(e).addClass("current-step"),!1):void 0}),b.parallaxBg&&b.$current.css({"background-position-y":c*b.parallaxBg}),b.$fade.length&&b.$fade.css({opacity:1-c/b.$fade.attr("data-fade")}),b.$slowScroll.length&&b.$slowScroll.css({"margin-top":c/b.$slowScroll.attr("data-slow-scroll")})):(b._ignoreHashChange=!0,b.$current.next().attr("id")&&b.setHash(b.$current.next().attr("id")),b.$current.removeClass("current").addClass("hidden").next("li").addClass("current").next("li").removeClass("hidden"),b.setCache(),b.options.nextSlide())},scrollMobileEvent:function(){var b=this,c=b.$element.scrollTop();c+10<b.currentP&&b.currentIndex>0?(b._ignoreHashChange=!0,b.$current.prev().attr("id")&&b.setHash(b.$current.prev().attr("id")),b.$current.removeClass("current").prev().addClass("current"),b.setCache(),b.options.prevSlide()):c+10<b.currentP+b.currentHeight?b.$stepLength&&a.each(b.$step,function(d,e){a(e).position().top+b.currentP<=c&&a(e).position().top+b.currentP+a(e).outerHeight()>=c&&(a(e).hasClass("current-step")||(b.$step.removeClass("current-step"),a(e).addClass("current-step")))}):(b._ignoreHashChange=!0,b.$current.next().attr("id")&&b.setHash(b.$current.next().attr("id")),b.$current.removeClass("current").next().addClass("current"),b.setCache(),b.options.nextSlide())},setDimensions:function(){var b=this,c=0,d=!1,e=null;b.$windowHeight=b.$window.height(),this.$li.each(function(f){var g=a(this);if(d=g.hasClass("cover"),d?(g.css({height:b.$windowHeight,zIndex:999-f}).attr("data-height",b.$windowHeight).attr("data-position",c),b.$elDatas[g.index()]={"data-height":parseInt(b.$windowHeight,10),"data-position":parseInt(c,10)},c+=b.$windowHeight):(e=g.outerHeight()<=b.$windowHeight?b.$windowHeight:g.outerHeight(),g.css({minHeight:e,zIndex:999-f}).attr("data-height",e).attr("data-position",c),b.$elDatas[g.index()]={"data-height":parseInt(e,10),"data-position":parseInt(c,10)},c+=e),g.find(".fixed").length){var h=g.find(".fixed").css("top");g.find(".fixed").attr("data-top",h)}}),this.options.mobile||this.setBodyHeight()},setEvents:function(){var c=this;a(b).on("resize",function(){c.setDimensions()}),c.options.mobile?c.$element.on("scroll",function(){c.scrollMobileEvent()}):c.$window.on("scroll",function(){c.scrollEvent()}),c.options.enableKeys&&c.$document.on("keydown",function(a){return 38===a.keyCode||37===a.keyCode?(c.scrollToPosition("up"),a.preventDefault(),!1):40===a.keyCode||39===a.keyCode?(c.scrollToPosition("down"),a.preventDefault(),!1):36===a.keyCode?(c.scrollToPosition("top"),a.preventDefault(),!1):35===a.keyCode?(c.scrollToPosition("bottom"),a.preventDefault(),!1):void 0}),c.options.scrollButtons&&(c.options.scrollButtons.up&&c.options.scrollButtons.up.on("click",function(a){a.preventDefault(),c.scrollToPosition("up")}),c.options.scrollButtons.down&&c.options.scrollButtons.down.on("click",function(a){a.preventDefault(),c.scrollToPosition("down")})),c.options.curtainLinks&&a(c.options.curtainLinks).on("click",function(b){b.preventDefault(),c.options.beforeLink();var d=a(this).attr("href"),e=null;if(a(d).hasClass("step")){var f=a(d);e=c.options.mobile?f.position().top+c.$elDatas[c.$current.index()]["data-position"]:f.position().top+c.$elDatas[c.$current.index()]["data-position"]}else e=c.$elDatas[a(d).index()]["data-position"]||null;return!c.isHashIsOnList(d.substring(1))&&e?!1:(e&&c.scrollEl.animate({scrollTop:e},c.options.scrollSpeed,c.options.easing),!1)}),c.$window.on("hashchange",function(){c._ignoreHashChange===!1&&c.isHashIsOnList(location.hash.substring(1)),c._ignoreHashChange=!1})},setBodyHeight:function(){var b=0;for(var c in this.$elDatas){var d=this.$elDatas[c];b+=d["data-height"]}this.options.bodyHeight=b,a("body").height(b)},setLinks:function(){var b=this;this.$li.each(function(){var c=a(this).attr("id")||0;b.options.linksArray.push(c)})},setHash:function(b){var c=a("[href=#"+b+"]");c.parent().siblings("li").removeClass("active"),c.parent().addClass("active"),history.pushState?history.pushState(null,null,"#"+b):location.hash=b},setCache:function(){var a=this;a.$current=a.$element.find(".current"),a.$fixed=a.$current.find(".fixed"),a.$fixedLength=a.$fixed.length,a.$step=a.$current.find(".step"),a.$stepLength=a.$step.length,a.currentIndex=a.$current.index(),a.currentP=a.$elDatas[a.currentIndex]["data-position"],a.currentHeight=a.$elDatas[a.currentIndex]["data-height"],a.parallaxBg=a.$current.attr("data-parallax-background"),a.$fade=a.$current.find("[data-fade]"),a.$slowScroll=a.$current.find("[data-slow-scroll]")},isHashIsOnList:function(b){var c=this;a.each(c.options.linksArray,function(a,d){return d===b?(c.scrollToPosition(b),!1):void 0})},readyElement:function(a,b){var c=setInterval(function(){a.length&&(b(a.length),clearInterval(c))},60)},imageLoaded:function(b){var c=this,e=c.$element.find("img"),f=e.length,g="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";e.bind("load.imgloaded",function(){(--f<=0&&this.src!==g||a(this).not(":visible"))&&(e.unbind("load.imgloaded"),b.call(e,this))}).each(function(){if(this.complete||this.complete===d){var a=this.src;this.src=g,this.src=a}})}},a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document);